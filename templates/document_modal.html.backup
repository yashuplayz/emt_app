<div class="modal-header bg-white border-bottom">
    <h5 class="modal-title text-danger fw-bold">{{ doc.request_id }}</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
        onclick="window.location.reload()"></button>
</div>

<div class="modal-body bg-light p-4">
    <div class="accordion" id="mainAccordion">

        <!-- Document Details -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#c1">
                    Document Details
                </button>
            </h2>
            <div id="c1" class="accordion-collapse collapse show" data-bs-parent="#mainAccordion">
                <div class="accordion-body">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label">Project No</label>
                            <input type="text" class="form-control" value="{{ doc.project_no }}" disabled>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Document No</label>
                            <input type="text" class="form-control" value="{{ doc.doc_number }}" disabled>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Revision</label>
                            <input type="text" class="form-control" value="{{ doc.revision_number }}" disabled>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-control" value="{{ doc.title }}" disabled>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Discipline</label>
                            <input type="text" class="form-control" value="{{ doc.discipline }}" disabled>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Baseline Date</label>
                            <input type="text" class="form-control" value="{{ doc.baseline_date }}" disabled>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Est. Hours</label>
                            <input type="text" class="form-control" value="{{ doc.estimation_hours }}" disabled>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">IDR Required?</label>
                            <input type="text" class="form-control" value="{{ doc.is_idr_required }}" disabled>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">SignOff Req?</label>
                            <input type="text" class="form-control" value="{{ doc.is_signoff_required }}" disabled>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Doc Owner</label>
                            <input type="text" class="form-control" value="{{ doc.doc_owner }}" disabled>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Originator</label>
                            <input type="text" class="form-control" value="{{ doc.originator }}" disabled>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Reviewer</label>
                            <input type="text" class="form-control" value="{{ doc.reviewer }}" disabled>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">SignOff Eng</label>
                            <input type="text" class="form-control" value="{{ doc.signoff_eng }}" disabled>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">DRM Category</label>
                            <input type="text" class="form-control" value="{{ doc.drm_category }}" disabled>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Originator Cycle 1 -->
        {% if doc.current_stage_code >= 1 %}
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button {{ 'collapsed' if doc.current_stage_code != 1 }}" type="button"
                    data-bs-toggle="collapse" data-bs-target="#oc1">
                    Originator Cycle 1
                    {% if doc.current_stage_code > 1 %} <span class="badge bg-success ms-2">Submitted</span> {% endif %}
                </button>
            </h2>
            <div id="oc1" class="accordion-collapse collapse {{ 'show' if doc.current_stage_code == 1 }}"
                data-bs-parent="#mainAccordion">
                <div class="accordion-body">
                    <form action="/submit_cycle/{{doc.id}}/OriginatorCycle_1" method="POST">
                        {% set data = cycles['OriginatorCycle_1'] if 'OriginatorCycle_1' in cycles else None %}

                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Actual Hours</label>
                                <input type="number" step="0.1" name="actual_hours" class="form-control"
                                    value="{{ data.actual_hours if data }}" {{ 'disabled' if data }}>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Transmittal Date</label>
                                <input type="date" name="transmittal_date" class="form-control"
                                    value="{{ data.transmittal_date if data }}" {{ 'disabled' if data }}>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label">Ref Link</label>
                                <input type="text" name="ref_link" class="form-control"
                                    value="{{ data.ref_link if data }}" {{ 'disabled' if data }}>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label">Description / Comments</label>
                                <textarea name="description" class="form-control" rows="3" {{ 'disabled' if data
                                    }}>{{ data.description if data }}</textarea>
                            </div>
                        </div>
                        {% if not data %}
                        <div class="mt-3 text-end"><button type="submit" class="btn btn-danger">Submit</button></div>
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Reviewer Cycle 1 -->
        {% if doc.current_stage_code >= 2 %}
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button {{ 'collapsed' if doc.current_stage_code != 2 }}" type="button"
                    data-bs-toggle="collapse" data-bs-target="#rc1">
                    Reviewer Cycle 1
                    {% if doc.current_stage_code > 2 %} <span class="badge bg-success ms-2">Submitted</span> {% endif %}
                </button>
            </h2>
            <div id="rc1" class="accordion-collapse collapse {{ 'show' if doc.current_stage_code == 2 }}"
                data-bs-parent="#mainAccordion">
                <div class="accordion-body">
                    <form action="/submit_cycle/{{doc.id}}/ReviewerCycle_1" method="POST">
                        {% set data = cycles['ReviewerCycle_1'] if 'ReviewerCycle_1' in cycles else None %}

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Reviewer Action</label>
                                <select name="action" class="form-select" {{ 'disabled' if data }}>
                                    <option>Accepted</option>
                                    <option>SendBack</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Review Hours</label>
                                <input type="number" step="0.1" name="review_hours" class="form-control"
                                    value="{{ data.review_hours if data }}" {{ 'disabled' if data }}>
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-primary">Major Issues</label>
                                <div class="input-group mb-2"><span class="input-group-text">Tool</span><input
                                        type="number" name="major_tool" class="form-control"
                                        value="{{ data.major_tool if data else 0 }}" {{ 'disabled' if data }}></div>
                                <div class="input-group mb-2"><span class="input-group-text">Tech</span><input
                                        type="number" name="major_tech" class="form-control"
                                        value="{{ data.major_tech if data else 0 }}" {{ 'disabled' if data }}></div>
                                <div class="input-group mb-2"><span class="input-group-text">Std</span><input
                                        type="number" name="major_std" class="form-control"
                                        value="{{ data.major_std if data else 0 }}" {{ 'disabled' if data }}></div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-primary">Minor Issues</label>
                                <div class="input-group mb-2"><span class="input-group-text">Typo</span><input
                                        type="number" name="minor_typo" class="form-control"
                                        value="{{ data.minor_typo if data else 0 }}" {{ 'disabled' if data }}></div>
                            </div>
                        </div>

                        {% if not data %}
                        <div class="mt-3 text-end"><button type="submit" class="btn btn-primary">Submit Review</button>
                        </div>
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Originator Cycle 2 -->
        {% if doc.current_stage_code >= 3 %}
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#oc2">
                    Originator Cycle 2
                    {% if doc.current_stage_code > 3 %} <span class="badge bg-success ms-2">Submitted</span> {% endif %}
                </button>
            </h2>
            <div id="oc2" class="accordion-collapse collapse {{ 'show' if doc.current_stage_code == 3 }}"
                data-bs-parent="#mainAccordion">
                <div class="accordion-body">
                    <form action="/submit_cycle/{{doc.id}}/OriginatorCycle_2" method="POST">
                        {% set data = cycles['OriginatorCycle_2'] if 'OriginatorCycle_2' in cycles else None %}

                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Actual Hours</label>
                                <input type="number" step="0.1" name="actual_hours" class="form-control"
                                    value="{{ data.actual_hours if data }}" {{ 'disabled' if data }}>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Transmittal Date</label>
                                <input type="date" name="transmittal_date" class="form-control"
                                    value="{{ data.transmittal_date if data }}" {{ 'disabled' if data }}>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label">Ref Link</label>
                                <input type="text" name="ref_link" class="form-control"
                                    value="{{ data.ref_link if data }}" {{ 'disabled' if data }}>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label">Description / Comments</label>
                                <textarea name="description" class="form-control" rows="3" {{ 'disabled' if data
                                    }}>{{ data.description if data }}</textarea>
                            </div>
                        </div>
                        {% if not data %}
                        <div class="mt-3 text-end"><button type="submit" class="btn btn-danger">Submit</button></div>
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Reviewer Cycle 2 -->
        {% if doc.current_stage_code >= 4 %}
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#rc2">
                    Reviewer Cycle 2
                    {% if doc.current_stage_code > 4 %} <span class="badge bg-success ms-2">Submitted</span> {% endif %}
                </button>
            </h2>
            <div id="rc2" class="accordion-collapse collapse {{ 'show' if doc.current_stage_code == 4 }}"
                data-bs-parent="#mainAccordion">
                <div class="accordion-body">
                    <form action="/submit_cycle/{{doc.id}}/ReviewerCycle_2" method="POST">
                        {% set data = cycles['ReviewerCycle_2'] if 'ReviewerCycle_2' in cycles else None %}

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Reviewer Action</label>
                                <select name="action" class="form-select" {{ 'disabled' if data }}>
                                    <option>Accepted</option>
                                    <option>SendBack</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Review Hours</label>
                                <input type="number" step="0.1" name="review_hours" class="form-control"
                                    value="{{ data.review_hours if data }}" {{ 'disabled' if data }}>
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-primary">Major Issues</label>
                                <div class="input-group mb-2"><span class="input-group-text">Tool</span><input
                                        type="number" name="major_tool" class="form-control"
                                        value="{{ data.major_tool if data else 0 }}" {{ 'disabled' if data }}></div>
                                <div class="input-group mb-2"><span class="input-group-text">Tech</span><input
                                        type="number" name="major_tech" class="form-control"
                                        value="{{ data.major_tech if data else 0 }}" {{ 'disabled' if data }}></div>
                                <div class="input-group mb-2"><span class="input-group-text">Std</span><input
                                        type="number" name="major_std" class="form-control"
                                        value="{{ data.major_std if data else 0 }}" {{ 'disabled' if data }}></div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-primary">Minor Issues</label>
                                <div class="input-group mb-2"><span class="input-group-text">Typo</span><input
                                        type="number" name="minor_typo" class="form-control"
                                        value="{{ data.minor_typo if data else 0 }}" {{ 'disabled' if data }}></div>
                            </div>
                        </div>

                        {% if not data %}
                        <div class="mt-3 text-end"><button type="submit" class="btn btn-primary">Submit Review</button>
                        </div>
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Originator Cycle 3 -->
        {% if doc.current_stage_code >= 5 %}
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#oc3">
                    Originator Cycle 3
                    {% if doc.current_stage_code > 5 %} <span class="badge bg-success ms-2">Submitted</span> {% endif %}
                </button>
            </h2>
            <div id="oc3" class="accordion-collapse collapse {{ 'show' if doc.current_stage_code == 5 }}"
                data-bs-parent="#mainAccordion">
                <div class="accordion-body">
                    <form action="/submit_cycle/{{doc.id}}/OriginatorCycle_3" method="POST">
                        {% set data = cycles['OriginatorCycle_3'] if 'OriginatorCycle_3' in cycles else None %}

                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Actual Hours</label>
                                <input type="number" step="0.1" name="actual_hours" class="form-control"
                                    value="{{ data.actual_hours if data }}" {{ 'disabled' if data }}>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Transmittal Date</label>
                                <input type="date" name="transmittal_date" class="form-control"
                                    value="{{ data.transmittal_date if data }}" {{ 'disabled' if data }}>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label">Ref Link</label>
                                <input type="text" name="ref_link" class="form-control"
                                    value="{{ data.ref_link if data }}" {{ 'disabled' if data }}>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label">Description / Comments</label>
                                <textarea name="description" class="form-control" rows="3" {{ 'disabled' if data
                                    }}>{{ data.description if data }}</textarea>
                            </div>
                        </div>
                        {% if not data %}
                        <div class="mt-3 text-end"><button type="submit" class="btn btn-danger">Submit</button></div>
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Reviewer Cycle 3 -->
        {% if doc.current_stage_code >= 6 %}
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#rc3">
                    Reviewer Cycle 3
                    {% if doc.current_stage_code > 6 %} <span class="badge bg-success ms-2">Submitted</span> {% endif %}
                </button>
            </h2>
            <div id="rc3" class="accordion-collapse collapse {{ 'show' if doc.current_stage_code == 6 }}"
                data-bs-parent="#mainAccordion">
                <div class="accordion-body">
                    <form action="/submit_cycle/{{doc.id}}/ReviewerCycle_3" method="POST">
                        {% set data = cycles['ReviewerCycle_3'] if 'ReviewerCycle_3' in cycles else None %}

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Reviewer Action</label>
                                <select name="action" class="form-select" {{ 'disabled' if data }}>
                                    <option>Accepted</option>
                                    <option>SendBack</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Review Hours</label>
                                <input type="number" step="0.1" name="review_hours" class="form-control"
                                    value="{{ data.review_hours if data }}" {{ 'disabled' if data }}>
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-primary">Major Issues</label>
                                <div class="input-group mb-2"><span class="input-group-text">Tool</span><input
                                        type="number" name="major_tool" class="form-control"
                                        value="{{ data.major_tool if data else 0 }}" {{ 'disabled' if data }}></div>
                                <div class="input-group mb-2"><span class="input-group-text">Tech</span><input
                                        type="number" name="major_tech" class="form-control"
                                        value="{{ data.major_tech if data else 0 }}" {{ 'disabled' if data }}></div>
                                <div class="input-group mb-2"><span class="input-group-text">Std</span><input
                                        type="number" name="major_std" class="form-control"
                                        value="{{ data.major_std if data else 0 }}" {{ 'disabled' if data }}></div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-primary">Minor Issues</label>
                                <div class="input-group mb-2"><span class="input-group-text">Typo</span><input
                                        type="number" name="minor_typo" class="form-control"
                                        value="{{ data.minor_typo if data else 0 }}" {{ 'disabled' if data }}></div>
                            </div>
                        </div>

                        {% if not data %}
                        <div class="mt-3 text-end"><button type="submit" class="btn btn-primary">Submit Review</button>
                        </div>
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- SignOff Engineer -->
        {% if doc.current_stage_code >= 8 %}
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#signoff">
                    SignOff Engineer
                    {% if doc.current_stage_code > 8 %} <span class="badge bg-success ms-2">Submitted</span> {% endif %}
                </button>
            </h2>
            <div id="signoff" class="accordion-collapse collapse {{ 'show' if doc.current_stage_code == 8 }}"
                data-bs-parent="#mainAccordion">
                <div class="accordion-body">
                    <form action="/submit_cycle/{{doc.id}}/SignOffEngineer" method="POST">
                        {% set data = cycles['SignOffEngineer'] if 'SignOffEngineer' in cycles else None %}

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">SignOff Decision</label>
                                <select name="signoff_decision" class="form-select" {{ 'disabled' if data }}>
                                    <option>Approved</option>
                                    <option>Hold</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">SignOff Hours</label>
                                <input type="number" step="0.1" name="signoff_hours" class="form-control"
                                    value="{{ data.signoff_hours if data }}" {{ 'disabled' if data }}>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label">Comments</label>
                                <textarea name="signoff_comments" class="form-control" rows="3" {{ 'disabled' if data
                                    }}>{{ data.signoff_comments if data }}</textarea>
                            </div>
                        </div>

                        {% if not data %}
                        <div class="mt-3 text-end"><button type="submit" class="btn btn-success">Complete
                                SignOff</button></div>
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>
        <option>Accepted</option>
        <option>SendBack</option>
        </select>
    </div>
    <div class="col-md-6">
        <label class="form-label">Review Hours</label>
        <input type="number" step="0.1" name="review_hours" class="form-control" value="{{ data.review_hours if data }}"
            {{ 'disabled' if data }}>
    </div>
</div>

<div class="row g-3">
    <div class="col-md-6">
        <label class="form-label fw-bold text-primary">Major Issues</label>
        <div class="input-group mb-2"><span class="input-group-text">Tool</span><input type="number" name="major_tool"
                class="form-control" value="{{ data.major_tool if data else 0 }}" {{ 'disabled' if data }}></div>
        <div class="input-group mb-2"><span class="input-group-text">Tech</span><input type="number" name="major_tech"
                class="form-control" value="{{ data.major_tech if data else 0 }}" {{ 'disabled' if data }}></div>
        <div class="input-group mb-2"><span class="input-group-text">Std</span><input type="number" name="major_std"
                class="form-control" value="{{ data.major_std if data else 0 }}" {{ 'disabled' if data }}></div>
    </div>
    <div class="col-md-6">
        <label class="form-label fw-bold text-primary">Minor Issues</label>
        <div class="input-group mb-2"><span class="input-group-text">Typo</span><input type="number" name="minor_typo"
                class="form-control" value="{{ data.minor_typo if data else 0 }}" {{ 'disabled' if data }}></div>
    </div>
</div>

{% if not data %}
<div class="mt-3 text-end"><button type="submit" class="btn btn-primary">Submit Review</button>
</div>
{% endif %}
</form>
</div>
</div>
</div>
{% endif %}

<!-- Originator Cycle 3 -->
{% if doc.current_stage_code >= 5 %}
<div class="accordion-item">
    <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#oc3">
            Originator Cycle 3
            {% if doc.current_stage_code > 5 %} <span class="badge bg-success ms-2">Submitted</span> {% endif %}
        </button>
    </h2>
    <div id="oc3" class="accordion-collapse collapse {{ 'show' if doc.current_stage_code == 5 }}"
        data-bs-parent="#mainAccordion">
        <div class="accordion-body">
            <form action="/submit_cycle/{{doc.id}}/OriginatorCycle_3" method="POST">
                {% set data = cycles['OriginatorCycle_3'] if 'OriginatorCycle_3' in cycles else None %}

                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">Actual Hours</label>
                        <input type="number" step="0.1" name="actual_hours" class="form-control"
                            value="{{ data.actual_hours if data }}" {{ 'disabled' if data }}>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Transmittal Date</label>
                        <input type="date" name="transmittal_date" class="form-control"
                            value="{{ data.transmittal_date if data }}" {{ 'disabled' if data }}>
                    </div>
                    <div class="col-md-12">
                        <label class="form-label">Ref Link</label>
                        <input type="text" name="ref_link" class="form-control" value="{{ data.ref_link if data }}"
                            {{ 'disabled' if data }}>
                    </div>
                    <div class="col-md-12">
                        <label class="form-label">Description / Comments</label>
                        <textarea name="description" class="form-control" rows="3" {{ 'disabled' if data
                            }}>{{ data.description if data }}</textarea>
                    </div>
                </div>
                {% if not data %}
                <div class="mt-3 text-end"><button type="submit" class="btn btn-danger">Submit</button></div>
                {% endif %}
            </form>
        </div>
    </div>
</div>
{% endif %}

<!-- Reviewer Cycle 3 -->
{% if doc.current_stage_code >= 6 %}
<div class="accordion-item">
    <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#rc3">
            Reviewer Cycle 3
            {% if doc.current_stage_code > 6 %} <span class="badge bg-success ms-2">Submitted</span> {% endif %}
        </button>
    </h2>
    <div id="rc3" class="accordion-collapse collapse {{ 'show' if doc.current_stage_code == 6 }}"
        data-bs-parent="#mainAccordion">
        <div class="accordion-body">
            <form action="/submit_cycle/{{doc.id}}/ReviewerCycle_3" method="POST">
                {% set data = cycles['ReviewerCycle_3'] if 'ReviewerCycle_3' in cycles else None %}

                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Reviewer Action</label>
                        <select name="action" class="form-select" {{ 'disabled' if data }}>
                            <option>Accepted</option>
                            <option>SendBack</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Review Hours</label>
                        <input type="number" step="0.1" name="review_hours" class="form-control"
                            value="{{ data.review_hours if data }}" {{ 'disabled' if data }}>
                    </div>
                </div>

                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label fw-bold text-primary">Major Issues</label>
                        <div class="input-group mb-2"><span class="input-group-text">Tool</span><input type="number"
                                name="major_tool" class="form-control" value="{{ data.major_tool if data else 0 }}"
                                {{ 'disabled' if data }}></div>
                        <div class="input-group mb-2"><span class="input-group-text">Tech</span><input type="number"
                                name="major_tech" class="form-control" value="{{ data.major_tech if data else 0 }}"
                                {{ 'disabled' if data }}></div>
                        <div class="input-group mb-2"><span class="input-group-text">Std</span><input type="number"
                                name="major_std" class="form-control" value="{{ data.major_std if data else 0 }}"
                                {{ 'disabled' if data }}></div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold text-primary">Minor Issues</label>
                        <div class="input-group mb-2"><span class="input-group-text">Typo</span><input type="number"
                                name="minor_typo" class="form-control" value="{{ data.minor_typo if data else 0 }}"
                                {{ 'disabled' if data }}></div>
                    </div>
                </div>

                {% if not data %}
                <div class="mt-3 text-end"><button type="submit" class="btn btn-primary">Submit Review</button>
                </div>
                {% endif %}
            </form>
        </div>
    </div>
</div>
{% endif %}

<!-- SignOff Engineer -->
{% if doc.current_stage_code >= 8 %}
<div class="accordion-item">
    <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#signoff">
            SignOff Engineer
            {% if doc.current_stage_code > 8 %} <span class="badge bg-success ms-2">Submitted</span> {% endif %}
        </button>
    </h2>
    <div id="signoff" class="accordion-collapse collapse {{ 'show' if doc.current_stage_code == 8 }}"
        data-bs-parent="#mainAccordion">
        <div class="accordion-body">
            <form action="/submit_cycle/{{doc.id}}/SignOffEngineer" method="POST">
                {% set data = cycles['SignOffEngineer'] if 'SignOffEngineer' in cycles else None %}

                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">SignOff Decision</label>
                        <select name="signoff_decision" class="form-select" {{ 'disabled' if data }}>
                            <option>Approved</option>
                            <option>Hold</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">SignOff Hours</label>
                        <input type="number" step="0.1" name="signoff_hours" class="form-control"
                            value="{{ data.signoff_hours if data }}" {{ 'disabled' if data }}>
                    </div>
                    <div class="col-md-12">
                        <label class="form-label">Comments</label>
                        <textarea name="signoff_comments" class="form-control" rows="3" {{ 'disabled' if data
                            }}>{{ data.signoff_comments if data }}</textarea>
                    </div>
                </div>

                {% if not data %}
                <div class="mt-3 text-end"><button type="submit" class="btn btn-success">Complete
                        SignOff</button></div>
                {% endif %}
            </form>
        </div>
    </div>
</div>
{% endif %}

</div>
</div>

<div class="modal-footer bg-white">
    {% if (current_user == doc.doc_owner or current_user == doc.originator) and doc.record_status == "Active" %}
    <a href="/delete/{{doc.id}}" class="btn btn-outline-danger me-auto"
        onclick="return confirm('Mark INACTIVE?')">Delete Request</a>
    {% endif %}
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
        onclick="window.location.reload()">Close</button>
</div>

<script>
    // Intercept all form submissions within the modal
    document.querySelectorAll('#modal-content form').forEach(form => {
        form.addEventListener('submit', function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            const url = this.action;

            fetch(url, {
                method: 'POST',
                body: formData
            })
                .then(response => response.text())
                .then(html => {
                    // Replace modal content with updated HTML
                    document.getElementById('modal-content').innerHTML = html;
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred. Please try again.');
                });
        });
    });
</script>